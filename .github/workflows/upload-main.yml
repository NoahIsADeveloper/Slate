name: Upload to Roblox

on:
  workflow_dispatch:
    inputs:
      reason:
        description: 'Why are you uploading?'
        required: false
        default: 'Manual trigger'

jobs:
  upload:
    runs-on: ubuntu-latest
    environment: ROBLOX-SECURITY-TOKEN

    steps:
      - name: Checkout repo
        uses: actions/checkout@v3

      - name: Install unzip (if not installed)
        run: sudo apt-get update && sudo apt-get install -y unzip

      - name: Download and install Rojo
        run: |
          curl -sL -o rojo.zip https://github.com/rojo-rbx/rojo/releases/latest/download/rojo-7.5.1-linux-x86_64.zip
          unzip -q rojo.zip
          chmod +x rojo
          sudo mv rojo /usr/local/bin/rojo

      - name: Upload to Roblox
        env:
          ROBLOSECURITY: ${{ secrets.ROBLOX_SECURITY }}
        run: |
          rojo upload --asset_id 106147285685243 --cookie "$ROBLOSECURITY"